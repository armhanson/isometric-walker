<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
    <link rel="stylesheet" href="style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <table>
      <tr>
        <td>
          <header style="font-family: 'Courier New', Courier, monospace">
            <h2>Walking Sim 2XD6!!</h2>
          </header>
        </td>
        <td class="inst" style="margin-left: 40px">
          <h3>:|:</h3>
        </td>
        <td class="inst" style="margin-left: 40px">
          <h3>Controls: Up - W, Down - S, Left - A, Right - D</h3>
        </td>

        <script>
          var config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            scene: {
              preload: preload,
              create: create,
              update: update,
            },
          };

          var game = new Phaser.Game(config);

          function preload() {
            this.load.image("backing", "assets/background/background_1.png");
            this.load.image("grass", "assets/background/grass.png");
            this.load.image("tree0", "assets/objects/tree0.png");
            this.load.spritesheet(
              "guy",
              "assets/sprites/guy_anim/guy_walk_sht.png",
              {
                frameWidth: 50,
                frameHeight: 75,
              }
            );
          }

          function create() {
            this.add.image(400, 300, "backing");
            this.add.image(400, 300, "grass");

            guy = this.add.sprite(75, 100, "guy");
            tree0 = this.add.sprite(475, 200, "tree0");

            this.anims.create({
              key: "walk",
              frames: this.anims.generateFrameNumbers("guy", {
                start: 0,
                end: 3,
              }),
              frameRate: 7.75,
              repeat: -1,
            });

            cursors = this.input.keyboard.addKeys("W, S, A, D");

            /// POTENTIAL FUNCTION TO UNIVERSALLY ADD OBJECT BOUNDARIES ///
            ////////////////// [[[ Â¡NEEDS MUCH WORK! ]]] //////////////////

            // treeObst = (x, y) => {
            //     // x begins drawing from top left corner horizontally
            //     // y begins drawing from top left corner vertically

            //     // create x - 80px X y - 50px rectangle.
            //     // connect vertical with horizontal lines at pixel corners
            //     // to prevent passing through box borders
            //     // and to prevent bouncing sprite in incorrect direction while
            //     // pressing alternate cursor keys that conflict with current
            //     // direction.

            //     // horz defines the length of x
            //     const horz = 80;
            //     // vert defines the length of y
            //     const vert = 50;

            //     // adds x coordinate to horz length to find right corner pixel
            //     const hLine = x+horz;
            //     // adds y coordinate to vert length to find bottom corner pixel
            //     const vLine = y+vert;

            //     const set = new Set(x, y, hLine, vLine);

            //     return Array.from(set);

            // }
          }

          function update() {
            // North, South, East, West boundaries
            if (guy.x > 725) {
              guy.x -= 1;
            }
            if (guy.x < 75) {
              guy.x += 1;
            }
            if (guy.y > 475) {
              guy.y -= 1;
            }
            if (guy.y < 75) {
              guy.y += 1;
            }

            const objParams = (obj, sprite) => {
              const sx = sprite.x;
              const sy = sprite.y;
              const xl = obj.x - 35;
              const xr = obj.x + 45;
              const yt = obj.y + 30;
              const yb = obj.y + 60;

              if (sx > xl && sx < xl + 3 && sy >= yt && sy <= yb) {
                return sprite.x = xl - 5; 
              } else if (sx < xr && sx > xr - 3 && sy >= yt && sy <= yb) {
                return sprite.x = xr + 5;
              } else if (sy > yt && sy < yt + 3 && sx >= xl && sx <= xr) {
                return sprite.y = yt - 5;
              } else if (sy < yb && sy > yb - 3 && sx >= xl && sx <= xr) {
                return sprite.y = yb + 5;
              }
            }

            if (cursors.D.isDown) {
              objParams(tree0, guy);
            }

            if (cursors.A.isDown) {
              objParams(tree0, guy);
            }

            if (cursors.W.isDown) {
              objParams(tree0, guy);
            }

            if (cursors.S.isDown) {
              objParams(tree0, guy);
            }

            let depthSort = guy.getDepth;

            // sorting guy in front of tree0
            if (guy.y > tree0.y + 50) {
              guy.setDepth(guy.y);
            }

            let treeReset = tree0.y + 50;

            // sorting tree0 in front of guy
            if (treeReset > guy.y) {
              guy.setDepth(0);
              tree0.setDepth(treeReset);
            }

            // walking animation implement and stop,
            // bouncing guy off game area borders
            if (
              cursors.A.isDown &&
              guy.x <= 726 &&
              guy.x >= 74 &&
              guy.y <= 476 &&
              guy.y >= 74
            ) {
              guy.x -= 1.5;

              guy.anims.play("walk", true);
            } else if (
              cursors.D.isUp &&
              cursors.A.isUp &&
              cursors.S.isUp &&
              cursors.W.isUp
            ) {
              guy.anims.play("walk", false);
            }

            if (
              cursors.D.isDown &&
              guy.x <= 726 &&
              guy.x >= 74 &&
              guy.y <= 476 &&
              guy.y >= 74
            ) {
              guy.x += 1.5;

              guy.anims.play("walk", true);
            } else if (
              cursors.D.isUp &&
              cursors.A.isUp &&
              cursors.S.isUp &&
              cursors.W.isUp
            ) {
              guy.anims.play("walk", false);
            }

            if (
              cursors.S.isDown &&
              guy.x <= 726 &&
              guy.x >= 74 &&
              guy.y <= 476 &&
              guy.y >= 74
            ) {
              guy.y += 1.5;

              guy.anims.play("walk", true);
            } else if (
              cursors.D.isUp &&
              cursors.A.isUp &&
              cursors.S.isUp &&
              cursors.W.isUp
            ) {
              guy.anims.play("walk", false);
            }


            if (
              cursors.W.isDown &&
              guy.x <= 726 &&
              guy.x >= 74 &&
              guy.y <= 476 &&
              guy.y >= 74
            ) {
              guy.y -= 1.5;

              guy.anims.play("walk", true);
            } else if (
              cursors.D.isUp &&
              cursors.A.isUp &&
              cursors.S.isUp &&
              cursors.W.isUp
            ) {
              guy.anims.play("walk", false);
            }
          }
        </script>
      </tr>
    </table>
  </body>
</html>
